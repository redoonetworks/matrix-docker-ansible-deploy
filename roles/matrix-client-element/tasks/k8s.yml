---
- name: Ensure helm templates folder exists
  ansible.builtin.file:
    path: "{{ matrix_helm_data_path }}/templates/{{ role_name }}"
    state: directory
    mode: 0750
    owner: "{{ matrix_user_username }}"
    group: "{{ matrix_user_groupname }}"

- name: copy helm templates
  ansible.builtin.copy:
    src: "{{ role_path }}/templates/k8s/{{ item }}"
    dest: "{{ matrix_helm_data_path }}/templates/{{ role_name }}/"
    owner: "{{ matrix_user_username }}"
    group: "{{ matrix_user_groupname }}"
    mode: 0660
  loop:
    - "configmap.yaml"  
    - "deployment.yaml"  
    - "service.yaml"

- ansible.builtin.set_fact:
    matrix_nginx_proxy_k8s_svc_replacements: "{{ matrix_nginx_proxy_k8s_svc_replacements + ['matrix-client-element'] }}"

# - name: copy matrix-synapse helm templates
#   ansible.builtin.template:
#     src: "{{ item.src }}"
#     dest: "{{ item.dest }}"
#     owner: "{{ matrix_user_username }}"
#     group: "{{ matrix_user_groupname }}"
#     mode: 0660
#   with_items:
#     - { src: "{{ role_path }}/templates/k8s/configmap.yaml.j2", dest: "{{ matrix_helm_data_path }}/templates/matrix-synapse/configmap.yaml" }    
#   when: matrix_k8s_mode | bool