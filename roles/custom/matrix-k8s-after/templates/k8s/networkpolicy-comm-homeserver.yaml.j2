# NetworkPolicy allows appservices to communicate with synapse 
---
kind: NetworkPolicy
apiVersion: networking.k8s.io/v1
metadata:
  name: {{ matrix_k8s_resource_prefix }}-comm-homeserver
spec:
  podSelector: 
    matchLabels:  
      communicate-homeserver: "true"
      {{ matrix_k8s_selector|to_nice_yaml(indent=6)|trim|indent(6) }}

  policyTypes:
    - Ingress
    - Egress
  
  ingress:
  - from:
    - podSelector:
        matchLabels:
          homeserver: "true"
          
  egress:
  - to:
    - podSelector:
        matchLabels:
          role: matrix-nginx-proxy
          {{ matrix_k8s_selector|to_nice_yaml(indent=10)|trim|indent(10) }}
  - to:
    - podSelector:
        matchLabels:
          role: matrix-synapse-reverse-proxy-companion
          {{ matrix_k8s_selector|to_nice_yaml(indent=10)|trim|indent(10) }}
