{% if matrix_k8s_configuration.files.secret is defined and matrix_k8s_configuration.files.secret|length > 0 %}
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    helm.sh/resource-policy: keep
  name: {{ matrix_k8s_resource_prefix }}-{{ resourceName }}
  labels:  
    {{ matrix_k8s_selector|to_nice_yaml(indent=4)|trim|indent(4) }}    
{% if matrix_k8s_configuration.secretLabels is defined and matrix_k8s_configuration.secretLabels|length > 0 %}
    {{ matrix_k8s_configuration.secretLabels|to_nice_yaml(indent=4)|trim|indent(4) }}
{% endif %}
stringData:
{% for line in matrix_k8s_configuration.files.secret %}
{% if line.src is defined %}
  {{ line.id }}: |-
{% raw %}{{{% endraw %} .Files.Get "{{ line.src }}" | indent 4 }}
{% endif %}    
{% endfor %}
{% endif %}
{% if secret_passwords is defined and secret_passwords|length > 0 %}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ matrix_k8s_resource_prefix }}-{{ resourceName }}-passwd
  labels:  
    {{ matrix_k8s_selector|to_nice_yaml(indent=4)|trim|indent(4) }}    
{% if matrix_k8s_configuration.secretPasswordLabels is defined and matrix_k8s_configuration.secretPasswordLabels|length > 0 %}
    {{ matrix_k8s_configuration.secretPasswordLabels|to_nice_yaml(indent=4)|trim|indent(4) }}
{% endif %}    
data:
{% for line in secret_passwords %}
  {{ line|upper }}: {{ secret_passwords[line] |replace('/','\\/') | b64encode  }}
{% endfor %}

{% endif %}
